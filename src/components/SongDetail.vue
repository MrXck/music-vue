<template>    <div id="song-detail" :class="playStore.isDark ? 'SongDetail dark' : 'SongDetail'">        <n-scrollbar style="height: calc(100vh - 80px - 24px)">            <div id="lyric-parent" class="lyric-parent" ref="lyric"></div>            <div class="comment">                <h3>最新评论 ({{ total }})</h3>                <Comment v-for="item in songComment" :comment="item" :star-url="'/songComment/star/'"/>                <n-space justify="center">                    <n-pagination                        v-if="total > 0"                        v-model:page="page"                        v-model:page-size="pageSize"                        @update:page="updatePage"                        @update:page-size="updatePageSize"                        :page-count="totalPage"                        show-size-picker                        :page-sizes="[10, 20, 30, 40]"                    />                </n-space>            </div>        </n-scrollbar>    </div></template><script>import {NScrollbar, NSpace, NPagination} from 'naive-ui'import {onMounted, watch, getCurrentInstance, ref} from 'vue'import {usePlayStore} from '../store'import request from '../utils/request'import Comment from './Comment'export default {    name: 'SongDetail',    setup(){        let playStore = usePlayStore()        let lyric = ''        let page = ref(1)        let pageSize = ref(10)        let totalPage = ref(0)        let songComment = ref([])        let total = ref(0)        let pList = document.getElementsByTagName('p')        onMounted(() => {            pList = document.getElementsByTagName('p')            setTimeout(()=>{                if(pList.length !== 1){                    playStore.audio.addEventListener('timeupdate', () => {                        let currentTime = Math.floor(playStore.audio.currentTime);                        let p = document.getElementById('time' + currentTime)                        if (p !== null) {                            for (let i = 0; i < pList.length; i++) {                                pList[i].className = 'yuan'                            }                            p.className = 'lyric big'                            let div = document.getElementById('lyric-parent')                            let boundingClientRect = div.getBoundingClientRect()                            div.scrollTo(0, p.offsetTop - (boundingClientRect.height / 2))                        }                    })                }            }, 200)            lyric = getCurrentInstance().refs.lyric            init()            initComment()        })        function timeFormat(time) {            let split = time.split(':')            switch (split.length) {                case 1:                    return Math.floor(split[0]);                case 2:                    return Math.floor(split[0]) * 60 + Math.floor(split[1])                case 3:                    return Math.floor(split[0]) * 3600 + Math.floor(split[1]) * 60 + Math.floor(split[2])            }        }        function init(){            let arr = playStore.playing.lyric.split("\n")            if (arr.length !== 1){                for (let i = 0; i < arr.length; i++) {                    let lyricArr = arr[i].split(']')                    let time = lyricArr[0].substring(1)                    let p = document.createElement('p')                    p.innerText = lyricArr[1]                    p.id = 'time' + timeFormat(time)                    if (lyricArr[1] !== undefined) {                        lyric.appendChild(p)                    }                }            }else {                let p = document.createElement('p')                p.innerText = '暂无歌词'                lyric.appendChild(p)            }        }        watch(() => playStore.playing.id, newVal => {            init()            initComment()        })        function initComment() {            if(playStore.playing.id !== ''){                request.get(`/songComment/${playStore.playing.id}?pageNum=${page.value}&pageSize=${pageSize.value}`).then(res => {                    if (res.data.code === 0) {                        songComment.value = res.data.data.records                        page.value = res.data.data.current                        pageSize.value = res.data.data.size                        total.value = res.data.data.total                        totalPage.value = res.data.data.pages                    }                })            }        }        function updatePage(value) {            page.value = value            initComment()        }        function updatePageSize(value) {            pageSize.value = value            initComment()        }        // function addComment() {        //     request.post('/songComment/addComment', {        //         songListId: route.params.id,        //         content: commentContent.value,        //     }).then(res => {        //         if (res.data.code === 0) {        //             message.success(res.data.data)        //         } else {        //             message.error(res.data.msg)        //         }        //     })        // }        return {            playStore,            songComment,            totalPage,            page,            pageSize,            total,            initComment,            updatePage,            updatePageSize,        }    },    components: {        Comment,        NScrollbar,        NSpace,        NPagination,    }}</script><style scoped>.SongDetail{    position: fixed;    top: 1500px;    width: 100%;    height: calc(100vh - 80px);    background-color: #fdfdfe;    z-index: 100;    transition: all .5s;}.lyric-parent{    margin-top: 100px;    display: flex;    flex-direction: column;    align-items: center;    height: 40vh;    overflow-y: auto;    overflow-x: hidden;    z-index: 200;}.lyric-parent::-webkit-scrollbar { /*滚动条整体样式*/    width: 4px; /*高宽分别对应横竖滚动条的尺寸*/    height: 4px;    scrollbar-arrow-color: red;}.lyric-parent::-webkit-scrollbar-thumb { /*滚动条里面小方块*/    border-radius: 5px;    -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);    background: rgba(0, 0, 0, 0.2);    scrollbar-arrow-color: red;}.lyric-parent::-webkit-scrollbar-track { /*滚动条里面轨道*/    -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);    border-radius: 0;    background: rgba(0, 0, 0, 0);}.dark{    /*background-color: #535354;*/    background-color: #101014;}.comment{    padding: 24px 20%;}.n-pagination {    margin-top: 10px;}</style>