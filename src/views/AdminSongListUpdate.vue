<template>    <n-space vertical align="start">        <n-space vertical item-style="min-width: 200px">            歌单名            <n-input v-model:value="songListDetail.name" type="text"/>        </n-space>        <n-space vertical align="center">            <n-avatar :size="200" :src="songListDetail.imgSrc" :fallback-src="notImage"></n-avatar>            <n-button @click="chooseImg">修改头像</n-button>            <input ref="file" type="file" class="hidden" @change="uploadImg">        </n-space>        <n-space vertical item-style="min-width: 200px">            创建者            <n-select filterable @update:value="updateCreator" v-model:value="creator" :options="creatorOptions"/>        </n-space>        <n-space vertical item-style="min-width: 200px">            选择歌曲            <n-select filterable multiple @update:value="update" v-model:value="value" :options="options"/>        </n-space>        <n-space>            <n-button @click="updateSongListDetail">提交</n-button>        </n-space>    </n-space></template><script>import notImage from '../assets/notImage.jpg'import {NSpace, NInput, NAvatar, NButton, useMessage, NSelect} from 'naive-ui'import {useRoute} from 'vue-router'import {getCurrentInstance, onMounted, reactive, ref} from 'vue'import request from '../utils/request'export default {    name: 'AdminSongListUpdate',    components: {NSpace, NInput, NAvatar, NButton, NSelect},    setup() {        const route = useRoute()        let file;        let message = useMessage()        let songListDetail = ref({            id: '',            name: '',            imgSrc: '',            songs: []        })        let songs = []        let options = reactive([])        let creatorOptions = reactive([])        let value = reactive([])        let creator = ref('')        let id = route.query.id        function init() {            request.get('/admin/user/all').then(res => {                if (res.data.code === 0) {                    for (let i = 0; i < res.data.data.length; i++) {                        creatorOptions.push({                            label: res.data.data[i].username,                            value: res.data.data[i].id,                        })                    }                }            })        }        onMounted(() => {            init()            file = getCurrentInstance().refs.file            if (id !== undefined) {                request.get('/songList/' + id).then(res => {                    if (res.data.code === 0) {                        songListDetail.value = res.data.data                        songs = res.data.data.songs                        for (let i = 0; i < songs.length; i++) {                            options.push({                                label: songs[i].name + ' 歌手:' + songs[i].singers[0].name,                                value: songs[i].id,                            })                            value.push(songs[i].id)                        }                    }                })            }        })        function uploadImg() {            if (!(file.files[0].type === "image/png") && !(file.files[0].type === "image/jpeg")) {                message.error("只能上传png/jpeg格式的图片文件，请重新上传")                return false            }            if (!(file.files[0].size / 1024 / 1024 < 2)) {                message.error('上传头像图片大小不能超过 2MB!');                return false            }            const param = new FormData()            param.append('file', file.files[0])            request.post('/file/uploadAvatar', param, {headers: {"Content-Type": "multipart/form-data"}}).then(res => {                if (res.data.code === 0) {                    songListDetail.value.imgSrc = res.data.data                }            })        }        function chooseImg() {            file.click()        }        function updateSongListDetail() {            let songList = []            for (let i = 0; i < value.length; i++) {                songList.push(songs.find(item => {                    return item.id === value[i]                }))            }            songListDetail.value.creator = creator.value            request.post('/songList/update', songListDetail.value).then(res => {                if (res.data.code === 0) {                    message.success('修改成功')                } else {                    message.error('修改失败')                }            })        }        function update(val) {            value.length = 0            value.push(...val)        }        function updateCreator(val) {            console.log(val)            creator.value = val        }        return {            notImage,            songListDetail,            options,            creatorOptions,            value,            creator,            chooseImg,            uploadImg,            update,            updateSongListDetail,            updateCreator,        }    }}</script><style scoped>.hidden {    display: none;}</style>