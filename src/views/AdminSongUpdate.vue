<template>    <n-space vertical align="start">        <n-space vertical item-style="min-width: 200px">            歌曲名            <n-input v-model:value="songDetail.name" type="text"/>        </n-space>        <n-space vertical item-style="min-width: 200px">            歌曲路径            <n-input v-model:value="songDetail.src" type="text"/>        </n-space>        <n-space vertical item-style="min-width: 200px">            歌曲时间            <n-input v-model:value="songDetail.time" type="number"/>        </n-space>        <n-space vertical align="center">            <n-avatar :size="200" :src="songDetail.imgSrc" :fallback-src="notImage"></n-avatar>            <n-button @click="chooseImg">修改头像</n-button>            <input ref="file" type="file" class="hidden" @change="uploadImg">        </n-space>        <n-space vertical item-style="min-width: 200px">            选择歌手            <n-select filterable multiple @update:value="update" v-model:value="value" :options="options"/>        </n-space>        <n-space vertical item-style="min-width: 200px">            歌词            <n-input type="textarea" v-model:value="songDetail.lyric"></n-input>        </n-space>        <n-space>            <n-button @click="updateSongDetail">提交</n-button>        </n-space>    </n-space></template><script>import notImage from '../assets/notImage.jpg'import {NSpace, NInput, NAvatar, NButton, useMessage, NSelect} from 'naive-ui'import {useRoute} from 'vue-router'import {getCurrentInstance, onMounted, reactive, ref} from 'vue'import request from '../utils/request'export default {    name: 'AdminSongUpdate',    components: {NSpace, NInput, NAvatar, NButton, NSelect},    setup() {        const route = useRoute()        let file;        let message = useMessage()        let songDetail = ref({            id: '',            name: '',            imgSrc: '',        })        let singers = []        let options = reactive([])        let value = reactive([])        let id = route.query.id        function init() {            request.get('/singer/list').then(res => {                if (res.data.code === 0){                    for (let i = 0; i < res.data.data.length; i++) {                        options.push({                            label: res.data.data[i].name,                            value: res.data.data[i].id,                        })                    }                    singers = res.data.data                }            })        }        onMounted(() => {            init()            file = getCurrentInstance().refs.file            if (id !== undefined) {                request.get('/song/' + id).then(res => {                    if (res.data.code === 0) {                        songDetail.value = res.data.data                        for (let i = 0; i < singers.length; i++) {                            value.push(singers[i].id)                        }                    }                })            }        })        function uploadImg() {            if (!(file.files[0].type === "image/png") && !(file.files[0].type === "image/jpeg")) {                message.error("只能上传png/jpeg格式的图片文件，请重新上传")                return false            }            if (!(file.files[0].size / 1024 / 1024 < 2)) {                message.error('上传头像图片大小不能超过 2MB!');                return false            }            const param = new FormData()            param.append('file', file.files[0])            request.post('/file/uploadAvatar', param, {headers: {"Content-Type": "multipart/form-data"}}).then(res => {                if (res.data.code === 0) {                    songDetail.value.imgSrc = res.data.data                }            })        }        function chooseImg() {            file.click()        }        function updateSongDetail() {            let singerList = []            console.log(singers)            for (let i = 0; i < value.length; i++) {                singerList.push(singers.find(item => {                    return item.id === value[i]                }))            }            songDetail.value.singers = singerList            request.post('/admin/song/update', songDetail.value).then(res => {                if (res.data.code === 0) {                    message.success('修改成功')                } else {                    message.error(res.data.msg)                }            })        }        function update(val) {            value.length = 0            value.push(...val)        }        return {            notImage,            songDetail,            options,            value,            chooseImg,            uploadImg,            update,            updateSongDetail,        }    }}</script><style scoped>.hidden {    display: none;}</style>ss